{% extends "web/app/app_base.html" %}
{% load i18n %}
{% load static %}
{% block app %}

<div class="container p-4">
    <h1 class="fs-4 fw-bold mb-4">Connected Accounts for Case: {{ case.name }}</h1>

    <!-- Return to Case Link -->
    <div class="mb-3">
        <a href="{% url 'case:case_detail' slug=case.slug %}" class="btn btn-secondary">Return to Case</a>
    </div>

    <div class="mb-3">
        <a href="{% url 'case:connect_client' slug=case.slug %}" class="btn btn-primary">Connect Another Account</a>
    </div>

    <!-- AWS Accounts -->
    <h2 class="fs-5 fw-semibold mt-4">AWS Accounts</h2>
    {% if aws_accounts %}
    <div class="table-responsive">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Account ID</th>
                    <th>Region</th>
                    <th>Added By</th>
                    <th>Added At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for account in aws_accounts %}
                <tr>
                    <td>
                        <a href="{% url 'aws:list_aws_resources' account.id %}" class="text-primary text-decoration-underline">
                            {{ account.account_id }}
                        </a>
                    </td>
                    <td>{{ account.aws_region }}</td>
                    <td>{{ account.added_by.username }}</td>
                    <td>{{ account.added_at|date:"Y-m-d H:i" }}</td>
                    <td>
                        {% if account.validated %}
                        <span class="badge bg-success">Validated</span>
                        {% else %}
                        <span class="badge bg-danger">Not Validated</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'aws:edit_account' account.id %}" class="btn btn-secondary btn-sm">Edit</a>
                        <button 
                            class="btn btn-danger btn-sm"
                            onclick="if(confirm('Are you sure you want to delete this account? This action cannot be undone.')) { window.location.href='{% url 'aws:delete_account' account.id %}'; }">
                            Delete
                        </button>
                        <a href="{% url 'aws:pull_aws_resources' account.id %}" class="btn btn-primary btn-sm">
                            Pull Resources
                        </a>
                        <a href="{% url 'aws:pull_log_source' account.id %}" class="btn btn-primary btn-sm">
                            Find Logging
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-muted">No AWS accounts connected yet.</p>
    {% endif %}

    <!-- GCP Placeholder -->
    <h2 class="fs-5 fw-semibold mt-4">GCP Accounts</h2>
    {% if gcp_placeholder %}
    <p class="text-muted">GCP integration coming soon.</p>
    {% endif %}

    <!-- Azure Placeholder -->
    <h2 class="fs-5 fw-semibold mt-4">Azure Accounts</h2>
    {% if azure_placeholder %}
    <p class="text-muted">Azure integration coming soon.</p>
    {% endif %}
</div>

{% endblock %}
